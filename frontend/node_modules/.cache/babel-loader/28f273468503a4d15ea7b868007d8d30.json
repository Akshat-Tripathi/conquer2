{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Akshat\\\\Documents\\\\Imperial\\\\personal\\\\conquer2\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _createClass from\"C:\\\\Users\\\\Akshat\\\\Documents\\\\Imperial\\\\personal\\\\conquer2\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _createSuper from\"C:\\\\Users\\\\Akshat\\\\Documents\\\\Imperial\\\\personal\\\\conquer2\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _inherits from\"C:\\\\Users\\\\Akshat\\\\Documents\\\\Imperial\\\\personal\\\\conquer2\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _classCallCheck from\"C:\\\\Users\\\\Akshat\\\\Documents\\\\Imperial\\\\personal\\\\conquer2\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import React,{Component,useState}from\"react\";import{ComposableMap,Geographies,Geography,ZoomableGroup}from\"react-simple-maps\";import ReactTooltip from\"react-tooltip\";// import { useSpring, animated } from \"react-spring\";\nimport\"./Map.css\";import{connect,loaddetails}from\"../api/index.js\";import Intro2 from\"../shashgonenuts/intro2\";import{username}from\"./Home.jsx\";import mapdata from\"../maps/world.txt\";var geoUrl=\"https://raw.githubusercontent.com/zcreativelabs/react-simple-maps/master/topojson-maps/world-110m.json\";var countriesLoaded=false;var countries={};var socket=null;var troops=0;var countryStates={};var playerColours={};var countryState=function countryState(Troops,Player){_classCallCheck(this,countryState);this.Troops=Troops;this.Player=Player;};var GameMap=/*#__PURE__*/function(_Component){_inherits(GameMap,_Component);var _super=_createSuper(GameMap);function GameMap(){var _this;_classCallCheck(this,GameMap);_this=_super.call(this);socket=connect();socket.onmessage=function(msg){var action=JSON.parse(msg.data);switch(action.Type){case\"updateTroops\":troops=action.Troops;break;case\"updateCountry\":if(typeof countryStates[action.Country]==\"undefined\"||countryStates[action.Country].Player!=action.Player){countryStates[action.Country]=new countryState(action.Troops,action.Player);}else{countryStates[action.Country].Troops+=action.Troops;}break;case\"newPlayer\":console.log(action.Player+\" has entered the chat bois as: \"+action.Country);playerColours[action.Player]=action.Country;}};return _this;}_createClass(GameMap,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(SideBar,null);}}]);return GameMap;}(Component);function SideBar(){//Fetch #troops, attack, move options, fix data vals\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),name=_useState4[0],setname=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),pop_est=_useState6[0],setpop_est=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),gdp=_useState8[0],setgdp=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),subrg=_useState10[0],setsubrg=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),continent=_useState12[0],setcontinent=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),display=_useState14[0],setdisplay=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),clickedCountry=_useState16[0],setclickedCountry=_useState16[1];var handleclickedCountry=function handleclickedCountry(ISO_A2){if(clickedCountry===\"\"){setclickedCountry(ISO_A2);}else{setclickedCountry(\"\");}};var CountryDetails=function CountryDetails(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",null,\"Spy Report On \",name,\":\"),/*#__PURE__*/React.createElement(\"h3\",null,\"Population: \",pop_est),/*#__PURE__*/React.createElement(\"h3\",null,\"GDP (PPP): \",gdp),continent!==\"South America\"&&/*#__PURE__*/React.createElement(\"h3\",null,\"Subregion: \",subrg),/*#__PURE__*/React.createElement(\"h3\",null,\"Continent: \",continent));};var handleColourFill=function handleColourFill(country){if(!countriesLoaded){loadMap();countriesLoaded=true;}var ISO_A2=country.properties.ISO_A2;if(clickedCountry!==\"\"&&countries[clickedCountry].includes(ISO_A2)){return\"#be90d4\";}try{var col=playerColours[countryStates[ISO_A2].Player];if(typeof col==\"undefined\"){col=\"#B9A37E\";}return col;}catch(TypeError){return\"#B9A37E\";}};return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"map-sidebar-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"map-sidebar-info-wrapper\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"START THE CONQUEST!\"),/*#__PURE__*/React.createElement(\"h2\",null,\"Welcome Commander \",username,\"!\")),/*#__PURE__*/React.createElement(\"p\",null,\"This is your war control room. Help us attain victory over our enemies. The Gods are on our side!\"),clickedCountry!==\"\"&&/*#__PURE__*/React.createElement(\"p\",null,\"Clicked Country: \",clickedCountry),display&&/*#__PURE__*/React.createElement(CountryDetails,null))),/*#__PURE__*/React.createElement(MapSettings,{setTooltipContent:setState,setname:setname,setgdp:setgdp,setpop_est:setpop_est,setdisplay:setdisplay,setcontinent:setcontinent,setsubrg:setsubrg,setclickedCountry:handleclickedCountry,handleColourFill:handleColourFill,handleColourStroke:handleColourFill}),/*#__PURE__*/React.createElement(ReactTooltip,null,state));}var getnum=function getnum(num){var num=Math.round(num);if(num>Math.pow(10,12)){num=num/Math.pow(10,12)+\" Trillion\";}else if(num>Math.pow(10,9)){num=num/Math.pow(10,9)+\" Billion\";}else if(num>Math.pow(10,6)){num=num/Math.pow(10,6)+\" Million\";}return num;};//Countries to not display\nfunction notThisCountry(country){var NAME=country.properties.NAME;return NAME!==\"\";}var clickedCountry;//TODO: player team colour for country\nfunction countryColors(country){var _country$properties=country.properties,NAME=_country$properties.NAME,ISO_A2=_country$properties.ISO_A2;return\"#AAA\";}function loadMap(){//TODO take value from the cookie\nfetch(\"/maps/world.txt\").then(function(raw){return raw.text();}).then(function(raw){return raw.split(\"\\n\");}).then(function(lines){return lines.map(function(s){return s.split(\" \");});}).then(function(lines){return lines.forEach(function(line){return countries[line[0]]=line.slice(1);});});}//FIXME: fix read file correctly\nfunction getCountryCodes(countrycode){// var fs = require(\"fs\");\nvar fileURL=\"/maps/world.txt\";var textByLine=\"\";fetch(fileURL).then(function(raw){return raw.text();}).then(function(raw){return raw.split(\"\\n\");}).then(function(raw){return raw.map(function(x){return x.split(\" \");});}).then(function(raw){return textByLine=raw;});var countriesBordering=[];for(var j=0;j<textByLine.length;j++){var borders=textByLine[j].split(\" \");if(borders[0]==countrycode){for(var i=1;i<borders.length;i++){//Get border codes\ncountriesBordering.push(borders[i]);}}}console.log(countriesBordering);return countriesBordering;}var MapSettings=function MapSettings(_ref){var setTooltipContent=_ref.setTooltipContent,setname=_ref.setname,setpop_est=_ref.setpop_est,setsubrg=_ref.setsubrg,setcontinent=_ref.setcontinent,setgdp=_ref.setgdp,setdisplay=_ref.setdisplay,setclickedCountry=_ref.setclickedCountry,handleColourFill=_ref.handleColourFill;return/*#__PURE__*/React.createElement(\"div\",{className:\"map-wrapper\"},/*#__PURE__*/React.createElement(ComposableMap,{\"data-tip\":\"\"},/*#__PURE__*/React.createElement(ZoomableGroup,null,/*#__PURE__*/React.createElement(Geographies,{geography:geoUrl},function(_ref2){var geographies=_ref2.geographies;return geographies.map(function(geo){return notThisCountry(geo)?/*#__PURE__*/React.createElement(Geography,{key:geo.rsmKey,geography:geo,fill:handleColourFill(geo),stroke:handleColourFill(geo),onMouseEnter:function onMouseEnter(){var _geo$properties=geo.properties,NAME=_geo$properties.NAME,POP_EST=_geo$properties.POP_EST,GDP_MD_EST=_geo$properties.GDP_MD_EST,SUBREGION=_geo$properties.SUBREGION,CONTINENT=_geo$properties.CONTINENT;// setTooltipContent(\n//   `${NAME} - $${getnum(GDP_MD_EST * Math.pow(10, 6))}`\n// );\nsetTooltipContent(\"\".concat(NAME,\" - ENEMY TERRITORY\"));setname(NAME);setpop_est(getnum(POP_EST));setgdp(getnum(GDP_MD_EST*Math.pow(10,6)));setsubrg(SUBREGION);setcontinent(CONTINENT);setdisplay(true);},onMouseLeave:function onMouseLeave(){setTooltipContent(\"\");setdisplay(false);},style:{default:{outline:\"none\"},hover:{fill:\"#D1BE9D\",stroke:\"#D1BE9D\",outline:\"none\"},pressed:{fill:\"#D6D6DA\",outline:\"none\"}},onClick:function onClick(){var ISO_A2=geo.properties.ISO_A2;setclickedCountry(ISO_A2);}}):null;});}))));};export default GameMap;","map":{"version":3,"sources":["C:/Users/Akshat/Documents/Imperial/personal/conquer2/frontend/src/pages/Map.jsx"],"names":["React","Component","useState","ComposableMap","Geographies","Geography","ZoomableGroup","ReactTooltip","connect","loaddetails","Intro2","username","mapdata","geoUrl","countriesLoaded","countries","socket","troops","countryStates","playerColours","countryState","Troops","Player","GameMap","onmessage","msg","action","JSON","parse","data","Type","Country","console","log","SideBar","state","setState","name","setname","pop_est","setpop_est","gdp","setgdp","subrg","setsubrg","continent","setcontinent","display","setdisplay","clickedCountry","setclickedCountry","handleclickedCountry","ISO_A2","CountryDetails","handleColourFill","country","loadMap","properties","includes","col","TypeError","getnum","num","Math","round","pow","notThisCountry","NAME","countryColors","fetch","then","raw","text","split","lines","map","s","forEach","line","slice","getCountryCodes","countrycode","fileURL","textByLine","x","countriesBordering","j","length","borders","i","push","MapSettings","setTooltipContent","geographies","geo","rsmKey","POP_EST","GDP_MD_EST","SUBREGION","CONTINENT","default","outline","hover","fill","stroke","pressed"],"mappings":"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","sourcesContent":["import React, { Component, useState } from \"react\";\r\nimport {\r\n  ComposableMap,\r\n  Geographies,\r\n  Geography,\r\n  ZoomableGroup,\r\n} from \"react-simple-maps\";\r\nimport ReactTooltip from \"react-tooltip\";\r\n// import { useSpring, animated } from \"react-spring\";\r\nimport \"./Map.css\";\r\nimport { connect, loaddetails } from \"../api/index.js\";\r\nimport Intro2 from \"../shashgonenuts/intro2\";\r\nimport { username } from \"./Home.jsx\";\r\n\r\nimport mapdata from \"../maps/world.txt\";\r\n\r\nconst geoUrl =\r\n  \"https://raw.githubusercontent.com/zcreativelabs/react-simple-maps/master/topojson-maps/world-110m.json\";\r\n\r\nvar countriesLoaded = false;\r\nvar countries = {};\r\nvar socket = null;\r\nvar troops = 0;\r\nvar countryStates = {};\r\nvar playerColours = {};\r\n\r\nclass countryState {\r\n    constructor(Troops, Player) {\r\n        this.Troops = Troops;\r\n        this.Player = Player;\r\n    }\r\n}\r\n\r\nclass GameMap extends Component {\r\n  constructor() {\r\n    super();\r\n    socket = connect();\r\n    socket.onmessage = (msg) => {\r\n        var action = JSON.parse(msg.data);\r\n        switch (action.Type) {\r\n            case \"updateTroops\":\r\n                troops = action.Troops;\r\n                break\r\n            case \"updateCountry\":\r\n                if (typeof countryStates[action.Country] == \"undefined\" || countryStates[action.Country].Player != action.Player) {\r\n                    countryStates[action.Country] = new countryState(action.Troops, action.Player);\r\n                } else {\r\n                    countryStates[action.Country].Troops += action.Troops;\r\n                }\r\n                break;\r\n            case \"newPlayer\":\r\n                console.log(action.Player + \" has entered the chat bois as: \" + action.Country);\r\n                playerColours[action.Player] = action.Country; \r\n        }\r\n      };\r\n  }\r\n\r\n  render() {\r\n    return <SideBar />;\r\n  }\r\n}\r\n\r\nfunction SideBar() {\r\n  //Fetch #troops, attack, move options, fix data vals\r\n  const [state, setState] = useState(\"\");\r\n\r\n  const [name, setname] = useState(\"\");\r\n  const [pop_est, setpop_est] = useState(\"\");\r\n  const [gdp, setgdp] = useState(\"\");\r\n  const [subrg, setsubrg] = useState(\"\");\r\n  const [continent, setcontinent] = useState(\"\");\r\n  const [display, setdisplay] = useState(false);\r\n  const [clickedCountry, setclickedCountry] = useState(\"\");\r\n\r\n  const handleclickedCountry = (ISO_A2) => {\r\n    if (clickedCountry === \"\") {\r\n      setclickedCountry(ISO_A2);\r\n    } else {\r\n      setclickedCountry(\"\");\r\n    }\r\n  };\r\n\r\n  const CountryDetails = () => {\r\n    return (\r\n      <div>\r\n        <h2>Spy Report On {name}:</h2>\r\n        <h3>Population: {pop_est}</h3>\r\n        <h3>GDP (PPP): {gdp}</h3>\r\n        {continent !== \"South America\" && <h3>Subregion: {subrg}</h3>}\r\n        <h3>Continent: {continent}</h3>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleColourFill = (country) => {\r\n    if (!countriesLoaded) {\r\n        loadMap();\r\n        countriesLoaded = true;\r\n    }\r\n    const { ISO_A2 } = country.properties;\r\n\r\n    if (\r\n        clickedCountry !== \"\" &&\r\n        countries[clickedCountry].includes(ISO_A2)\r\n    ) {\r\n      return \"#be90d4\";\r\n    }\r\n    try {\r\n        var col = playerColours[countryStates[ISO_A2].Player];\r\n        if (typeof col == \"undefined\") {\r\n            col = \"#B9A37E\";\r\n        }\r\n        return col;\r\n    } catch (TypeError) {\r\n        return \"#B9A37E\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"map-sidebar-wrapper\">\r\n        <div className=\"map-sidebar-info-wrapper\">\r\n          <div>\r\n            <h1>START THE CONQUEST!</h1>\r\n            <h2>Welcome Commander {username}!</h2>\r\n          </div>\r\n          <p>\r\n            This is your war control room. Help us attain victory over our\r\n            enemies. The Gods are on our side!\r\n          </p>\r\n          {clickedCountry !== \"\" && <p>Clicked Country: {clickedCountry}</p>}\r\n          {display && <CountryDetails />}\r\n        </div>\r\n      </div>\r\n      <MapSettings\r\n        setTooltipContent={setState}\r\n        setname={setname}\r\n        setgdp={setgdp}\r\n        setpop_est={setpop_est}\r\n        setdisplay={setdisplay}\r\n        setcontinent={setcontinent}\r\n        setsubrg={setsubrg}\r\n        setclickedCountry={handleclickedCountry}\r\n        handleColourFill={handleColourFill}\r\n        handleColourStroke={handleColourFill}\r\n      />\r\n      <ReactTooltip>{state}</ReactTooltip>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst getnum = (num) => {\r\n  var num = Math.round(num);\r\n  if (num > Math.pow(10, 12)) {\r\n    num = num / Math.pow(10, 12) + \" Trillion\";\r\n  } else if (num > Math.pow(10, 9)) {\r\n    num = num / Math.pow(10, 9) + \" Billion\";\r\n  } else if (num > Math.pow(10, 6)) {\r\n    num = num / Math.pow(10, 6) + \" Million\";\r\n  }\r\n  return num;\r\n};\r\n\r\n//Countries to not display\r\nfunction notThisCountry(country) {\r\n  const { NAME } = country.properties;\r\n  return NAME !== \"\";\r\n}\r\n\r\nvar clickedCountry;\r\n//TODO: player team colour for country\r\nfunction countryColors(country) {\r\n  const { NAME, ISO_A2 } = country.properties;\r\n  return \"#AAA\";\r\n}\r\n\r\nfunction loadMap() {\r\n    //TODO take value from the cookie\r\n    fetch(\"/maps/world.txt\")\r\n        .then(raw => raw.text())\r\n        .then(raw => raw.split(\"\\n\"))\r\n        .then(lines => lines.map(s => s.split(\" \")))\r\n        .then(lines => lines.forEach(line => countries[line[0]] = line.slice(1,)));\r\n}\r\n\r\n//FIXME: fix read file correctly\r\nfunction getCountryCodes(countrycode) {\r\n  // var fs = require(\"fs\");\r\n  const fileURL = \"/maps/world.txt\";\r\n  var textByLine = \"\";\r\n  fetch(fileURL)\r\n    .then((raw) => raw.text())\r\n    .then((raw) => raw.split(\"\\n\"))\r\n    .then((raw) => raw.map((x) => x.split(\" \")))\r\n    .then((raw) => textByLine = raw);\r\n\r\n  var countriesBordering = [];\r\n\r\n  for (let j = 0; j < textByLine.length; j++) {\r\n    var borders = textByLine[j].split(\" \");\r\n    if (borders[0] == countrycode) {\r\n      for (let i = 1; i < borders.length; i++) {\r\n        //Get border codes\r\n        countriesBordering.push(borders[i]);\r\n      }\r\n    }\r\n  }\r\n  console.log(countriesBordering);\r\n  return countriesBordering;\r\n}\r\n\r\nconst MapSettings = ({\r\n  setTooltipContent,\r\n  setname,\r\n  setpop_est,\r\n  setsubrg,\r\n  setcontinent,\r\n  setgdp,\r\n  setdisplay,\r\n  setclickedCountry,\r\n  handleColourFill,\r\n}) => {\r\n  return (\r\n    <div className=\"map-wrapper\">\r\n      <ComposableMap data-tip=\"\">\r\n        <ZoomableGroup>\r\n          <Geographies geography={geoUrl}>\r\n            {({ geographies }) =>\r\n              geographies.map((geo) =>\r\n                notThisCountry(geo) ? (\r\n                  <Geography\r\n                    key={geo.rsmKey}\r\n                    geography={geo}\r\n                    fill={handleColourFill(geo)}\r\n                    stroke={handleColourFill(geo)}\r\n                    onMouseEnter={() => {\r\n                      const {\r\n                        NAME,\r\n                        POP_EST,\r\n                        GDP_MD_EST,\r\n                        SUBREGION,\r\n                        CONTINENT,\r\n                      } = geo.properties;\r\n\r\n                      // setTooltipContent(\r\n                      //   `${NAME} - $${getnum(GDP_MD_EST * Math.pow(10, 6))}`\r\n                      // );\r\n\r\n                      setTooltipContent(`${NAME} - ENEMY TERRITORY`);\r\n                      setname(NAME);\r\n                      setpop_est(getnum(POP_EST));\r\n                      setgdp(getnum(GDP_MD_EST * Math.pow(10, 6)));\r\n                      setsubrg(SUBREGION);\r\n                      setcontinent(CONTINENT);\r\n                      setdisplay(true);\r\n                    }}\r\n                    onMouseLeave={() => {\r\n                      setTooltipContent(\"\");\r\n                      setdisplay(false);\r\n                    }}\r\n                    style={{\r\n                      default: {\r\n                        outline: \"none\",\r\n                      },\r\n                      hover: {\r\n                        fill: \"#D1BE9D\",\r\n                        stroke: \"#D1BE9D\",\r\n                        outline: \"none\",\r\n                      },\r\n                      pressed: {\r\n                        fill: \"#D6D6DA\",\r\n                        outline: \"none\",\r\n                      },\r\n                    }}\r\n                    onClick={() => {\r\n                      const { ISO_A2 } = geo.properties;\r\n                      setclickedCountry(ISO_A2);\r\n                    }}\r\n                  />\r\n                ) : null\r\n              )\r\n            }\r\n          </Geographies>\r\n        </ZoomableGroup>\r\n      </ComposableMap>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GameMap;\r\n"]},"metadata":{},"sourceType":"module"}